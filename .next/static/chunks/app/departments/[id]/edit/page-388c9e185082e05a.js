(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[120],{3724:function(e,t,a){Promise.resolve().then(a.bind(a,7501))},7501:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var n=a(7437),r=a(2265),s=a(5452),i=a(9376),d=a(8387),l=a(2869),c=a(6070),o=a(2660),u=a(8420),m=a(5805),h=a(7648);function p(){var e,t;let[a,p]=(0,r.useState)(null),[x,f]=(0,r.useState)(""),[y,v]=(0,r.useState)(""),[j,g]=(0,r.useState)(""),[k,b]=(0,r.useState)([]),[N,Z]=(0,r.useState)(!0),[_,w]=(0,r.useState)(!1),[M,z]=(0,r.useState)(""),[C,S]=(0,r.useState)(!1),D=(0,i.useRouter)(),q=(0,i.useParams)().id,E=(0,s.createClientComponentClient)();(0,r.useEffect)(()=>{let e=async()=>{let{data:{user:e}}=await E.auth.getUser();if(!e){D.push("/auth/login");return}let{data:t}=await E.from("organization_members").select("role, organization_id").eq("user_id",e.id).single();if(!t||!["owner","admin"].includes(t.role)){alert("You do not have permission to edit departments"),D.push("/departments");return}S(!0);let{data:a,error:n}=await E.from("departments").select("id, name, description, head_user_id, organization_id").eq("id",q).single();if(n||!a){console.error("Error loading department:",n),D.push("/departments");return}p(a),f(a.name),v(a.description||""),g(a.head_user_id);let{data:r}=await E.from("organization_members").select("\n          user_id,\n          role,\n          profiles:user_id (\n            email,\n            full_name\n          )\n        ").eq("organization_id",t.organization_id).in("role",["admin","department_head","member"]);b((null==r?void 0:r.map(e=>{var t,a;return{id:e.user_id,email:(null===(t=e.profiles)||void 0===t?void 0:t.email)||"",full_name:null===(a=e.profiles)||void 0===a?void 0:a.full_name}}))||[]),Z(!1)};q&&e()},[D,E,q]);let H=async e=>{e.preventDefault(),w(!0),z("");try{if(!a)throw Error("Department not found");let{error:e}=await E.from("departments").update({name:x.trim(),description:y.trim()||null,head_user_id:j}).eq("id",q);if(e)throw e;D.push("/departments/".concat(q))}catch(e){console.error("Error updating department:",e),z(e.message||"Failed to update department")}finally{w(!1)}};return N?(0,n.jsx)(d.Z,{children:(0,n.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})})}):C&&a?(0,n.jsx)(d.Z,{children:(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsx)("div",{className:"mb-8",children:(0,n.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,n.jsx)(h.default,{href:"/departments/".concat(q),children:(0,n.jsxs)(l.z,{variant:"ghost",size:"sm",children:[(0,n.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Back to Department"]})}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.Z,{className:"h-6 w-6 text-primary"}),(0,n.jsx)("h1",{className:"text-xl font-semibold",children:"Edit Department"})]})]})}),(0,n.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,n.jsxs)(c.Zb,{children:[(0,n.jsxs)(c.Ol,{children:[(0,n.jsx)(c.ll,{children:"Department Information"}),(0,n.jsx)(c.SZ,{children:"Update the department details and assign a department head"})]}),(0,n.jsx)(c.aY,{children:(0,n.jsxs)("form",{onSubmit:H,className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Department Name *"}),(0,n.jsx)("input",{id:"name",type:"text",value:x,onChange:e=>f(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"e.g., Engineering, Sales, Marketing"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,n.jsx)("textarea",{id:"description",value:y,onChange:e=>v(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Describe the department's purpose and responsibilities..."})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"headUser",className:"block text-sm font-medium text-gray-700 mb-2",children:"Department Head *"}),(0,n.jsxs)("select",{id:"headUser",value:j,onChange:e=>g(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,n.jsx)("option",{value:"",children:"Select a department head..."}),k.map(e=>(0,n.jsx)("option",{value:e.id,children:e.full_name||e.email},e.id))]}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"The department head will have additional permissions to manage this department"})]}),M&&(0,n.jsx)("div",{className:"text-red-600 text-sm bg-red-50 p-3 rounded-md",children:M}),(0,n.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,n.jsx)(h.default,{href:"/departments/".concat(q),children:(0,n.jsx)(l.z,{variant:"outline",type:"button",children:"Cancel"})}),(0,n.jsx)(l.z,{type:"submit",disabled:_,children:_?"Saving...":"Save Changes"})]})]})})]}),(0,n.jsxs)(c.Zb,{className:"mt-6",children:[(0,n.jsx)(c.Ol,{children:(0,n.jsxs)(c.ll,{className:"text-lg flex items-center space-x-2",children:[(0,n.jsx)(m.Z,{className:"h-5 w-5"}),(0,n.jsx)("span",{children:"Department Overview"})]})}),(0,n.jsx)(c.aY,{children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Current Name"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:a.name})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Current Description"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:a.description||"No description"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Current Head"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:(null===(e=k.find(e=>e.id===a.head_user_id))||void 0===e?void 0:e.full_name)||(null===(t=k.find(e=>e.id===a.head_user_id))||void 0===t?void 0:t.email)||"Not assigned"})]})]})})]})]})]})}):(0,n.jsx)(d.Z,{children:(0,n.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Access Denied"}),(0,n.jsx)("p",{className:"text-gray-600 mt-2",children:"You don't have permission to edit this department."}),(0,n.jsx)(l.z,{onClick:()=>D.push("/departments"),className:"mt-4",children:"Back to Departments"})]})})})}},4401:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]])},2660:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6221:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]])},2222:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]])},8420:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},875:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},407:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},8293:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]])},9397:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},8728:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},5805:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},2489:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},1239:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]])},7648:function(e,t,a){"use strict";a.d(t,{default:function(){return r.a}});var n=a(2972),r=a.n(n)}},function(e){e.O(0,[284,523,972,672,971,117,744],function(){return e(e.s=3724)}),_N_E=e.O()}]);