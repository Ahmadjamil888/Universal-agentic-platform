(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[913],{6619:function(e,a,t){Promise.resolve().then(t.bind(t,3749))},3749:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return I}});var r=t(7437),s=t(2265),n=t(5452),i=t(9376),l=t(8387),d=t(2869),o=t(6070),c=t(5186),m=t(6815),u=t(6818),p=t(7265),f=t(875),h=t(2135),x=t(401),g=t(4508);let j=p.fC;p.ZA;let b=p.B4,y=s.forwardRef((e,a)=>{let{className:t,children:s,...n}=e;return(0,r.jsxs)(p.xz,{ref:a,className:(0,g.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[s,(0,r.jsx)(p.JO,{asChild:!0,children:(0,r.jsx)(f.Z,{className:"h-4 w-4 opacity-50"})})]})});y.displayName=p.xz.displayName;let N=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(p.u_,{ref:a,className:(0,g.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,r.jsx)(h.Z,{className:"h-4 w-4"})})});N.displayName=p.u_.displayName;let v=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(p.$G,{ref:a,className:(0,g.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,r.jsx)(f.Z,{className:"h-4 w-4"})})});v.displayName=p.$G.displayName;let w=s.forwardRef((e,a)=>{let{className:t,children:s,position:n="popper",...i}=e;return(0,r.jsx)(p.h_,{children:(0,r.jsxs)(p.VY,{ref:a,className:(0,g.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...i,children:[(0,r.jsx)(N,{}),(0,r.jsx)(p.l_,{className:(0,g.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,r.jsx)(v,{})]})})});w.displayName=p.VY.displayName,s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(p.__,{ref:a,className:(0,g.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s})}).displayName=p.__.displayName;let _=s.forwardRef((e,a)=>{let{className:t,children:s,...n}=e;return(0,r.jsxs)(p.ck,{ref:a,className:(0,g.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(p.wU,{children:(0,r.jsx)(x.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(p.eT,{children:s})]})});_.displayName=p.ck.displayName,s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(p.Z0,{ref:a,className:(0,g.cn)("-mx-1 my-1 h-px bg-muted",t),...s})}).displayName=p.Z0.displayName;var C=t(2660),z=t(8420),k=t(5805),Z=t(7648);function I(){var e;let[a,t]=(0,s.useState)(null),[p,f]=(0,s.useState)(""),[h,x]=(0,s.useState)(!0),[g,N]=(0,s.useState)(!1),[v,I]=(0,s.useState)({name:"",description:"",headUserId:"",employeeCount:5}),[D,S]=(0,s.useState)([]),E=(0,i.useRouter)(),R=(0,n.createClientComponentClient)();(0,s.useEffect)(()=>{(async()=>{let{data:{user:e}}=await R.auth.getUser();if(!e){E.push("/auth/login");return}let{data:a}=await R.from("organization_members").select("role, organization_id").eq("user_id",e.id).single();if(!a){E.push("/organization/setup");return}if(!["owner","admin"].includes(a.role)){E.push("/dashboard");return}t(e),f(a.role);let{data:r}=await R.from("organization_members").select("\n          user_id,\n          profiles:user_id (\n            id,\n            full_name,\n            email\n          )\n        ").eq("organization_id",a.organization_id);r&&S(r.map(e=>{var a,t,r;return{id:e.user_id,name:(null===(a=e.profiles)||void 0===a?void 0:a.full_name)||(null===(t=e.profiles)||void 0===t?void 0:t.email)||"",email:(null===(r=e.profiles)||void 0===r?void 0:r.email)||""}})),I(a=>({...a,headUserId:e.id})),x(!1)})()},[E,R]);let U=async e=>{if(e.preventDefault(),a&&v.name.trim()){N(!0);try{let{data:e}=await R.from("organization_members").select("organization_id").eq("user_id",a.id).single();if(!e)throw Error("Organization not found");let{data:t,error:r}=await R.from("departments").insert({organization_id:e.organization_id,name:v.name,description:v.description,head_user_id:v.headUserId}).select().single();if(r)throw r;await R.from("department_members").insert({department_id:t.id,user_id:v.headUserId,role:"head"}),E.push("/departments")}catch(e){console.error("Error creating department:",e),alert("Failed to create department. Please try again.")}finally{N(!1)}}},F=(e,a)=>{I(t=>({...t,[e]:a}))};return h?(0,r.jsx)(l.Z,{children:(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})})}):(0,r.jsx)(l.Z,{children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto p-6",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)(Z.default,{href:"/departments",children:(0,r.jsxs)(d.z,{variant:"ghost",className:"mb-4",children:[(0,r.jsx)(C.Z,{className:"h-4 w-4 mr-2"}),"Back to Departments"]})}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Create New Department"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Set up a new department for your organization"})]}),(0,r.jsxs)(o.Zb,{children:[(0,r.jsxs)(o.Ol,{children:[(0,r.jsxs)(o.ll,{className:"flex items-center space-x-2",children:[(0,r.jsx)(z.Z,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"Department Information"})]}),(0,r.jsx)(o.SZ,{children:"Fill in the details for your new department"})]}),(0,r.jsx)(o.aY,{children:(0,r.jsxs)("form",{onSubmit:U,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(m._,{htmlFor:"name",children:"Department Name *"}),(0,r.jsx)(c.I,{id:"name",value:v.name,onChange:e=>F("name",e.target.value),placeholder:"e.g., Marketing, Sales, Engineering",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(m._,{htmlFor:"employeeCount",children:"Expected Employee Count"}),(0,r.jsx)(c.I,{id:"employeeCount",type:"number",value:v.employeeCount,onChange:e=>F("employeeCount",parseInt(e.target.value)||1),min:"1",placeholder:"5"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(m._,{htmlFor:"description",children:"Description"}),(0,r.jsx)(u.g,{id:"description",value:v.description,onChange:e=>F("description",e.target.value),placeholder:"Describe the department's responsibilities and goals",rows:3})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(m._,{htmlFor:"headUser",children:"Department Head *"}),(0,r.jsxs)(j,{value:v.headUserId,onValueChange:e=>F("headUserId",e),children:[(0,r.jsx)(y,{children:(0,r.jsx)(b,{placeholder:"Select department head"})}),(0,r.jsx)(w,{children:D.map(e=>(0,r.jsxs)(_,{value:e.id,children:[e.name," (",e.email,")"]},e.id))})]}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"The department head will have management privileges for this department"})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsxs)("h4",{className:"font-medium mb-2 flex items-center",children:[(0,r.jsx)(k.Z,{className:"h-4 w-4 mr-2"}),"Summary"]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Department:"}),(0,r.jsx)("p",{className:"font-medium",children:v.name||"Not specified"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Expected Employees:"}),(0,r.jsx)("p",{className:"font-medium",children:v.employeeCount})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Department Head:"}),(0,r.jsx)("p",{className:"font-medium",children:(null===(e=D.find(e=>e.id===v.headUserId))||void 0===e?void 0:e.name)||"Not selected"})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)(Z.default,{href:"/departments",children:(0,r.jsx)(d.z,{type:"button",variant:"outline",children:"Cancel"})}),(0,r.jsx)(d.z,{type:"submit",disabled:g||!v.name.trim(),children:g?"Creating Department...":"Create Department"})]})]})})]})]})})}},5186:function(e,a,t){"use strict";t.d(a,{I:function(){return i}});var r=t(7437),s=t(2265),n=t(4508);let i=s.forwardRef((e,a)=>{let{className:t,type:s,...i}=e;return(0,r.jsx)("input",{type:s,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:a,...i})});i.displayName="Input"},6815:function(e,a,t){"use strict";t.d(a,{_:function(){return o}});var r=t(7437),s=t(2265),n=t(6394),i=t(535),l=t(4508);let d=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(n.f,{ref:a,className:(0,l.cn)(d(),t),...s})});o.displayName=n.f.displayName},6818:function(e,a,t){"use strict";t.d(a,{g:function(){return i}});var r=t(7437),s=t(2265),n=t(4508);let i=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:a,...s})});i.displayName="Textarea"}},function(e){e.O(0,[284,523,972,214,161,917,672,971,117,744],function(){return e(e.s=6619)}),_N_E=e.O()}]);