(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[519],{6223:function(e,t,a){Promise.resolve().then(a.bind(a,9291))},9291:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return E}});var s=a(7437),r=a(2265),n=a(5452),d=a(9376),i=a(8387),l=a(2869),o=a(6070),c=a(535),m=a(4508);let f=(0,c.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function u(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{className:(0,m.cn)(f({variant:a}),t),...r})}var x=a(9397),p=a(8420),h=a(7684),j=a(2208),g=a(4630),N=a(8930),y=a(5805),b=a(7648),v=a(3032),w=a(407),_=a(401),z=a(519);let Z=v.fC,C=v.xz;v.ZA,v.Uv,v.Tr,v.Ee,r.forwardRef((e,t)=>{let{className:a,inset:r,children:n,...d}=e;return(0,s.jsxs)(v.fF,{ref:t,className:(0,m.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",a),...d,children:[n,(0,s.jsx)(w.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=v.fF.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(v.tu,{ref:t,className:(0,m.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=v.tu.displayName;let R=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,s.jsx)(v.Uv,{children:(0,s.jsx)(v.VY,{ref:t,sideOffset:r,className:(0,m.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});R.displayName=v.VY.displayName;let k=r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(v.ck,{ref:t,className:(0,m.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",a),...n})});function E(){let[e,t]=(0,r.useState)(null),[a,c]=(0,r.useState)(""),[m,f]=(0,r.useState)([]),[v,w]=(0,r.useState)(!0),_=(0,d.useRouter)(),z=(0,n.createClientComponentClient)();(0,r.useEffect)(()=>{(async()=>{let{data:{user:e}}=await z.auth.getUser();if(!e){_.push("/auth/login");return}t(e);let{data:a}=await z.from("organization_members").select("role, organization_id").eq("user_id",e.id).single();if(!a){_.push("/organization/setup");return}c(a.role);let s=z.from("departments").select("\n          id,\n          name,\n          description,\n          head_user_id,\n          created_at,\n          profiles:head_user_id (\n            full_name,\n            email\n          )\n        ").eq("organization_id",a.organization_id);if("member"===a.role){let{data:t}=await z.from("department_members").select("department_id").eq("user_id",e.id);t&&t.length>0&&(s=s.in("id",t.map(e=>e.department_id)))}let{data:r,error:n}=await s.order("created_at",{ascending:!1});if(n){console.error("Error loading departments:",n);return}f(await Promise.all((r||[]).map(async e=>{let[t,a]=await Promise.all([z.from("department_members").select("id",{count:"exact"}).eq("department_id",e.id),z.from("agent_department_associations").select("id",{count:"exact"}).eq("department_id",e.id)]);return{...e,head_user:e.profiles,member_count:t.count||0,agent_count:a.count||0}}))),w(!1)})()},[_,z]);let E=async e=>{if(confirm("Are you sure you want to delete this department? This action cannot be undone."))try{let{error:t}=await z.from("departments").delete().eq("id",e);if(t)throw t;f(m.filter(t=>t.id!==e))}catch(e){console.error("Error deleting department:",e),alert("Failed to delete department. Please try again.")}},D=["owner","admin"].includes(a);return v?(0,s.jsx)(i.Z,{children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})})}):(0,s.jsx)(i.Z,{children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Departments"}),(0,s.jsx)("p",{className:"text-gray-600 mt-1",children:D?"Manage departments and their AI resources":"View your department and AI resources"})]}),D&&(0,s.jsx)(b.default,{href:"/departments/create",children:(0,s.jsxs)(l.z,{className:"flex items-center space-x-2",children:[(0,s.jsx)(x.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Add Department"})]})})]}),0===m.length?(0,s.jsx)(o.Zb,{children:(0,s.jsxs)(o.aY,{className:"flex flex-col items-center justify-center py-16",children:[(0,s.jsx)(p.Z,{className:"h-12 w-12 text-gray-400 mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No departments found"}),(0,s.jsx)("p",{className:"text-gray-600 text-center mb-6",children:D?"Get started by creating your first department":"No departments are currently assigned to you"}),D&&(0,s.jsx)(b.default,{href:"/departments/create",children:(0,s.jsxs)(l.z,{children:[(0,s.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Create Department"]})})]})}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(e=>{var t,a;return(0,s.jsxs)(o.Zb,{className:"hover:shadow-lg transition-shadow",children:[(0,s.jsx)(o.Ol,{children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(o.ll,{className:"text-lg",children:e.name}),(0,s.jsx)(o.SZ,{className:"mt-1",children:e.description||"No description provided"})]}),D&&(0,s.jsxs)(Z,{children:[(0,s.jsx)(C,{asChild:!0,children:(0,s.jsx)(l.z,{variant:"ghost",size:"sm",children:(0,s.jsx)(h.Z,{className:"h-4 w-4"})})}),(0,s.jsxs)(R,{align:"end",children:[(0,s.jsx)(k,{asChild:!0,children:(0,s.jsxs)(b.default,{href:"/departments/".concat(e.id),children:[(0,s.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"View Details"]})}),(0,s.jsx)(k,{asChild:!0,children:(0,s.jsxs)(b.default,{href:"/departments/".concat(e.id,"/edit"),children:[(0,s.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"Edit"]})}),(0,s.jsxs)(k,{onClick:()=>E(e.id),className:"text-red-600",children:[(0,s.jsx)(N.Z,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})}),(0,s.jsx)(o.aY,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Department Head"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:(null===(t=e.head_user)||void 0===t?void 0:t.full_name)||(null===(a=e.head_user)||void 0===a?void 0:a.email)||"Not assigned"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)(y.Z,{className:"h-4 w-4 text-gray-400"}),(0,s.jsxs)("span",{className:"text-sm text-gray-600",children:[e.member_count," members"]})]}),(0,s.jsxs)(u,{variant:"secondary",className:"flex items-center space-x-1",children:[(0,s.jsx)(p.Z,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:[e.agent_count," agents"]})]})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(b.default,{href:"/departments/".concat(e.id),className:"flex-1",children:(0,s.jsx)(l.z,{variant:"outline",size:"sm",className:"w-full",children:"View Details"})}),(0,s.jsx)(b.default,{href:"/departments/".concat(e.id,"/agents"),children:(0,s.jsx)(l.z,{size:"sm",variant:"outline",children:"Manage AI"})})]})]})})]},e.id)})})]})})}k.displayName=v.ck.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:n,...d}=e;return(0,s.jsxs)(v.oC,{ref:t,className:(0,m.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:n,...d,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(v.wU,{children:(0,s.jsx)(_.Z,{className:"h-4 w-4"})})}),r]})}).displayName=v.oC.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(v.Rk,{ref:t,className:(0,m.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(v.wU,{children:(0,s.jsx)(z.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=v.Rk.displayName,r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(v.__,{ref:t,className:(0,m.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...n})}).displayName=v.__.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(v.Z0,{ref:t,className:(0,m.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=v.Z0.displayName}},function(e){e.O(0,[284,523,972,214,161,399,672,971,117,744],function(){return e(e.s=6223)}),_N_E=e.O()}]);